{
  "hash": "c7d0bef16e3faf546f77a9266604b341",
  "result": {
    "markdown": "---\ntitle: \"Quality control metaproteomics\"\nauthor: \n  - name: Johan S. Sáenz \n    affiliations: University of Hohenheim\ndate: \"05-05-2023\"\ncategories: [R, metaproteomics]\nformat:\n   pdf:\n    toc: true\n    keep-tex: true\n    number-sections: true\n    colorlinks: true\n    fig-pos: 'h'\n    code-block-bg: true\n   html:\n    toc: true\n    toc-location: left\n---\n\n\n\n# Quality control of metapreotomics data\n\n## Set-up environment\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## libraries\nlibrary(tidyverse)\n\n\n# input data\n\n# Metaproteomics quality control data from MaxQuant\ndf_qc <- read.table(\"../../project/rawdata/final_summary.tsv\",\n                    header = TRUE,\n                    sep = \"\\t\",\n                    check.names = FALSE)\n# Metadata\nmetadata <- read.table(\"../../project/rawdata/metadata_metapro.txt\",\n                       header = TRUE,\n                       sep = \"\\t\"\n                       )\n```\n:::\n\n\n\n## Clean metadata\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmetadata_clean <- metadata %>%\n  rename(sample = Probenname) %>%\n  mutate(sample = str_replace_all(sample, \"\\\\.\", \"_\")) %>%\n  separate(Abschnitt,\n    into = c(\"region\", \"source\",\n      sep = \" \"\n    )\n  )\n```\n:::\n\n\n\n## Clean quality data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclean_qc <- df_qc %>%\n  select(\n    \"Raw file\",\n    \"Peptide Sequences Identified\",\n    \"MS/MS Identified\",\n    \"MS/MS Identified [%]\"\n  ) %>%\n  rename(\n    sample = \"Raw file\",\n    peptide_identified = \"Peptide Sequences Identified\",\n    ms_identified = \"MS/MS Identified\",\n    ms_identified_perc = \"MS/MS Identified [%]\"\n  ) %>%\n  filter(sample != \"Total\")\n```\n:::\n\n\n\n## Create a summary table\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmax(clean_qc$peptide_identified)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 27841\n```\n:::\n\n```{.r .cell-code}\nsapply(clean_qc[2:4], mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\npeptide_identified      ms_identified ms_identified_perc \n         10646.400          17453.600             26.159 \n```\n:::\n\n```{.r .cell-code}\nsummary_table <- data.frame(\n  stats = c(\"Max\", \"Mean\", \"Min\"),\n  peptide_identified = round(c(25687.0, 11420.1500, 472.00)),\n  ms_identified = round(c(28442.0, 13235.5000, 766.00)),\n  ms_identified_perc = round(c(29.9, 14.8755, 0.98), 2)\n)\n\nsummary_table\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  stats peptide_identified ms_identified ms_identified_perc\n1   Max              25687         28442              29.90\n2  Mean              11420         13236              14.88\n3   Min                472           766               0.98\n```\n:::\n\n```{.r .cell-code}\nwrite.csv(summary_table, \"../../project/rawdata/summary.csv\")\n```\n:::\n\n\n\n## Pivot data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npivoted_data <- clean_qc %>%\n  pivot_longer(-(sample), names_to = \"qc\", values_to = \"value\")\n\nhead(pivoted_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  sample qc                    value\n  <chr>  <chr>                 <dbl>\n1 10_1   peptide_identified   642   \n2 10_1   ms_identified       1045   \n3 10_1   ms_identified_perc     1.96\n4 10_18  peptide_identified 24411   \n5 10_18  ms_identified      36628   \n6 10_18  ms_identified_perc    54.6 \n```\n:::\n:::\n\n\n\n## Plot the data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n pivoted_data %>%\n  filter(qc==\"peptide_identified\") %>% \n   ggplot(aes(x=value,\n             y=sample)) +\n  geom_bar(stat = \"identity\") +\n  geom_vline(aes(xintercept=mean(value)),\n              color=\"blue\", linetype=\"dashed\") +\n  scale_x_continuous(expand = c(0,0),\n                     limits = c(0, 29000),\n                     breaks=seq(0, 29000, by=3000)) +\n  labs(x=\"\",\n       y=\"Number of identified peptides\") +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](qc_metaproteomics_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n pivoted_data %>%\n   filter(qc==\"peptide_identified\") %>%\n  ggplot(aes(x=sample,\n             y=value)) +\n  geom_point(size=4)+\n  geom_hline(aes(yintercept=mean(value)),\n             color=\"blue\", linetype=\"dashed\") +\n  scale_y_continuous(expand = c(0,0),\n                     limits = c(0, 27000),\n                     breaks=seq(0, 27000, by=3000)) +\n  labs(x=\"\",\n       y=\"Number of identified peptides\") +\n  theme_classic()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 1 rows containing missing values (`geom_point()`).\n```\n:::\n\n::: {.cell-output-display}\n![](qc_metaproteomics_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n pivoted_data %>%\n  filter(qc==\"peptide_identified\") %>%\n  ggplot(aes(x=\"peptides\",\n             y=value)) +\n  geom_boxplot(width = 0.3)+ \n  geom_jitter(width = 0.1,\n              size = 3,\n              color = \"red\",\n              alpha = 0.6) +\n  scale_y_continuous(expand = c(0,0),\n                     limits = c(0, 29000),\n                     breaks=seq(0, 29000, by=3000)) +\n  labs(x=\"\",\n       y=\"Number of identified peptides\") +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](qc_metaproteomics_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n pivoted_data %>%\n  filter(qc==\"peptide_identified\") %>%\n  inner_join(metadata_clean, by=\"sample\") %>%\n  ggplot(aes(x=region,\n             y=value,\n             color=region)) +\n  geom_boxplot(width = 0.3,\n               outlier.shape = NA, \n               show.legend = FALSE)+ \n  geom_jitter(width= 0.1,\n              size=3, \n              show.legend = FALSE,\n              alpha = 0.6) +\n  scale_y_continuous(expand = c(0,0),\n                     limits = c(0, 30000),\n                     breaks=seq(0, 30000, by=3000)) +\n  labs(x=\"\",\n       y=\"Number of identified peptides\") +\n  scale_color_manual(values = c(\"red\", \"blue\")) +\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](qc_metaproteomics_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n pivoted_data %>%\n   inner_join(metadata_clean, \n              by = \"sample\"\n              ) %>%\n   ggplot(aes(x = region,\n              y = value,\n              color = region\n              )\n          ) +\n   geom_boxplot(outlier.shape = NA, \n                show.legend = FALSE\n                ) +\n   geom_jitter(size = 3,\n               show.legend = FALSE\n               ) +\n   scale_y_continuous(expand = c(0, 0),\n                      # limits = c(0, 27000),\n                      # breaks=seq(0, 27000, by=3000)\n                      ) +\n   labs(x = \"\",\n        y = \"Number of identified peptides\"\n        ) +\n   scale_color_manual(values = c(\"red\", \"blue\")\n                      ) +\n   theme_classic() +\n   facet_wrap(~qc, \n              scales = \"free\"\n              )\n```\n\n::: {.cell-output-display}\n![](qc_metaproteomics_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "qc_metaproteomics_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}